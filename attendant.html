<!DOCTYPE html>
<html>
<head>
    <title>EMU Print Center Attendant</title>
    <link rel="stylesheet" href="css/inject.css" />
    <link rel="stylesheet" href="css/interface.css" />
    <link rel="stylesheet" href="css/attendant.css" />
</head>
<body>
    <div id="app">

        <div id="pos-checkout-toolbar" class="center">
            <div class="buttons left">
            </div>
            EMU Print Center: Attendant
            <div class="buttons right" v-cloak>
                <button v-on:click="signOut" v-if="isSignedIn"><i class="fas fa-sign-out-alt"></i> Sign Out</button>
                <button v-on:click="signIn" v-else><i class="fas fa-sign-in-alt"></i> Sign In</button>
            </div>
        </div>

        <div class="container" v-cloak>
            
            <div v-if="isSignedIn">
                <section class="section current-order">
                    <header>
                        <h2 class="pull-left">Current Order</h2>
                        <div class="pull-right" v-if="currentOrder.items.length > 0">
                            <div v-if="currentOrder.isPaid">
                                <button class="btn btn-light">
                                    <i class="fas fa-print"></i> Print Customer Receipt
                                </button>
                                <button class="btn btn-light" v-on:click="clearScreen()">
                                    <i class="fas fa-arrow-right"></i> Clear Screen
                                </button>
                            </div>
                            <button v-else-if="!currentOrder.isReadyToPay" class="btn btn-light" v-on:click="readyToPay()">
                                <i class="fas fa-check"></i> Ready to Pay
                            </button>
                            <button v-else class="btn btn-light" v-on:click="editOrder()">
                                <i class="fas fa-edit"></i> Edit Order
                            </button>
                            
                            <button v-if="!currentOrder.isPaid" class="btn btn-red" v-on:click="cancelOrder()">
                                <i class="fas fa-times"></i> Cancel Order
                            </button>
                        </div>
                    </header>

                    <item-table :items="currentOrder.items" :show-total-row="true" :delete-item="deleteItemCurrentOrder" :show-placeholder="false"
                    :editable="!currentOrder.isReadyToPay && !currentOrder.isPaid"></item-table>
                    
                    <div v-if="currentOrder.isReadyToPay && !currentOrder.isPaid">
                        Payment Method <i class="fas fa-arrow-right"></i> &nbsp;
                        <button class="btn btn-light" v-on:click="selectPaymentMethod('card')">
                            <i class="fas fa-credit-card"></i> Card
                        </button>
                        <button class="btn btn-light" v-on:click="selectPaymentMethod('inter')">
                            <i class="fas fa-exchange-alt"></i> Interdepartmental
                        </button>
                        <button class="btn btn-light" v-on:click="selectPaymentMethod('card+inter')">
                            <i class="fas fa-credit-card"></i> Card + <i class="fas fa-exchange-alt"></i> Interdepartmental
                        </button>
                        <!--<p class="payment-instruction">If customer is paying with card, they can click "Pay by Card" on the customer screen. The system will automatically fill in the total and walk through the process on the Emich Payment Site.</p>-->
                    </div>

                    <div v-if="currentOrder.isSplitPayment && currentOrder.splitPayment.interdepartmentalAmount > 0" class="payment-box">
                        <u>Split Payment Method</u>
                        <br>
                        Interdepartmental Form: <b>${{ currentOrder.splitPayment.interdepartmentalAmount }}</b>
                        <br>
                        Charge to Card: <b>${{ currentOrder.splitPayment.cardAmount }}</b>
                    </div>

                    <p v-if="currentOrder.isPaid">
                        <i class="fas fa-check-circle"></i> 
                        <span v-if="currentOrder.isCard">Card payment complete.</span>
                        <span v-else>Paid via Interdepartmental Transfer Form.</span>
                    </p>

                    <div v-else-if="currentOrder.isReadyToPay" class="payment-method-options">
                        <div v-if="currentOrder.isSplitPayment && !currentOrder.isCard" class="split-payment payment-box">
                            <form class="styled" v-on:submit.prevent="savePaymentSubmit">
                                <div class="input-group">
                                    <label>Amount covered by interdepartmental transfer form:</label> <br>
                                    $<input type="number" class="control" name="inter" required min="1" :max="total" step="0.01" 
                                    :value="interdepartmentalAmount" v-on:change="updateInterdepartmentalAmount" v-on:keyup="updateInterdepartmentalAmount" />
                                </div>
                                <div class="input-group">
                                    <label>Amount to charge to card:</label> <br>
                                    $<input type="number" class="control" name="card" required min="1" :max="total" step="0.01" :value="cardAmount" />
                                </div>
                               
                                <button class="btn" type="submit">Submit</button>
                                <br>
                                <small><i>Clicking submit will allow the customer to enter their card info and proceed through checkout like normal.</i></small>
                            </form>
                        </div>
                        <div v-else-if="currentOrder.isInterdepartmental" class="payment-box">
                            <p class="mt-0"><i>Payment via interdepartmental transfer form.</i> Please confirm that the transfer form can cover this amount. Clicking Confirm will <b>finalize</b> this order. </p>
                            <button class="btn btn-orange" v-on:click="interdepartmentalFinalize()">Confirm</button>
                        </div>
                    </div>

                    <item-adder v-else :new-item="newItemCurrentOrder"></item-adder>

                    <p class="payment-instruction" v-if="currentOrder.isCard && !currentOrder.isPaid">Waiting for card payment from customer...</p>

                </section><!-- end .current-order-->

                <section class="section orders">

                    <header>
                        <h2 class="pull-left">
                            Orders
                            <select>
                                <option>All</option>
                                <option>Not Paid</option>
                                <option>Paid</option>
                            </select>
                        </h2>
                        <button class="btn pull-right"><i class="fas fa-plus"></i> Add Email Order</button>
                    </header>
                    
                    <div class="order" v-cloak>
                        <header>
                            <h3 class="pull-left">Order #1</h3>
                            <span class="header-details pull-right">
                                <span class="paid not">Hasn't Paid</span> 
                                <br>
                                <a href="#"><i class="fas fa-dollar-sign"></i> Begin Payment</a>
                            </span>
                        </header>
                        <div class="details">
                            <p class="contact"><i>Contact:</i> John Doe &bull; john@doe.com</p>
                            <p class="notes"><i>Notes:</i> they want this, and that, and that</p>
                            <div class="items">
                                <h4>Items in this order</h4>
                               <item-table :show-total-row="true" :show-placeholder="false"></item-table>
                            </div>
                        </div><!-- end .details-->
                    </div><!-- end .order-->

                </section><!-- end section.orders-->

            </div>
            <div v-else class="sign-in-text">
                <p class="text-large">Sign in to access the print center attendant interface.</p>
                <button class="btn btn-lg" v-on:click="signIn">Sign in with Google</button>
            </div>
        </div>

    </div><!-- end #app-->

    <script type="text/x-template" id="item-table">
        <table class="item-table" v-if="parsedItems && parsedItems.length > 0">
            <tr>
                <th class="product">Product</th>
                <th class="right">Cost</th>
                <th class="right">Qty</th>
                <th class="right">Total</th>
                <th v-if="editable && total > 0"></th>
            </tr>
            <tr v-for="(item,key) in parsedItems" :key="key">
                <td class="product">{{ item.name }}</td>
                <td class="right">{{ item.cost }}</td>
                <td v-if="editable" class="right"><input type="number" v-model="items[key].qty" class="qty" min="1" /></td>
                <td v-else class="right">{{ item.qty }}</td>
                <td class="right">{{ item.total }}</td>
                <td v-if="editable && items.length > 0" class="right delete" title="Remove item from order"><i class="fas fa-trash" v-on:click="deleteItem(key)"></i></td>
            </tr>
            <tr v-if="showTotalRow && total > 0">
                <td colspan="4" class="total">Total: <b>${{ total.toFixed(2) }}</b></td>
            </tr>
        </table>
    </script>

    <script type="text/x-template" id="item-adder">
        <div class="item-adder">
            <button type="submit" class="btn btn-light" v-on:click="toggleForm()" v-if="!isFormVisible">
                <i class="fas fa-plus"></i>  Add Item
            </button>

            <form class="styled" v-on:submit.prevent="addItemSubmit" v-if="isFormVisible">
                <div class="input-group">
                    <input type="text" required v-model="selectedType" class="v-select-input-proxy" />
                    <v-select v-model="selectedType" :options="itemTypes" placeholder="Choose item type..."></v-select>
                </div>
                
                <div class="input-group" v-if="isPoster">
                    <input required type="number" placeholder="Length (in)" min="1" class="control" v-model="posterLength" /> &times;
                    <input required type="number" placeholder="Width (in)" min="1" max="41" class="control" v-model="posterWidth" />
                    <select v-on:change="applyPreset" class="preset-size">
                        <option value="null">Or, select a preset...</option>
                        <option v-for="size in presetSizes" :value="size.l+'x'+size.w">{{ size.l }} x {{ size.w }}</option>
                    </select>
                    <br>
                    <span class="help"><i>Length > 54" won't fit in cutting board.</i> <b>Max printable width is 41".</b></span>
                </div>

                <input required type="number" min="1" name="qty" placeholder="Quantity" class="control" v-model="qty" />
                <br>

                <div class="buttons">
                    <button type="submit" class="btn btn-light">
                        <i class="fas fa-plus"></i>  Add Item
                    </button>
                    <small><a href="#" v-on:click.prevent="toggleForm()">Close</a></small>
                </div>
            </form>

        </div>
    </script>

    <script src="https://unpkg.com/vue-select@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/vue.js"></script>
    <script src="js/attendant.js"></script>
</body>
</html>
